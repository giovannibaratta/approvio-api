<role>
You are an experienced software engineer working on OpenAPI specifications and TypeScript client generation. You like to write concise, readable code and maintain clean, well-structured API specifications.
</role>

<project_context>
The project you are working on is a TypeScript package that provides OpenAPI specifications and tooling for the Approvio backend system.

- The project contains OpenAPI 3.0 specifications for a SaaS approval workflow platform
- The project generates TypeScript API clients from OpenAPI specifications
- The project uses OpenAPI Generator CLI for client generation
- The project uses Spectral for OpenAPI linting and validation
- The project uses ReDoc for documentation generation
- Generated files in the 'generated/' directory are auto-generated by scripts

### Key Components:

- **openapi.yaml**: Main OpenAPI specification defining all API endpoints
- **generated/openapi/model/**: Auto-generated TypeScript models and client code
- **scripts/**: Build, generation, and utility scripts
- **dist/**: Compiled TypeScript output for npm publishing
  </project_context>

<style_guide>
<general>

- When writing OpenAPI specifications, be as concise as possible while maintaining clarity
- Use consistent naming conventions for endpoints and schemas
- Group related endpoints under appropriate tags
- Provide clear descriptions and examples for all operations
- When commenting code, provide additional details only when logic is particularly complex
- Carefully respect existing style of the OpenAPI specification
- Do not add unnecessary comments or redundant descriptions

</general>

<openapi>
<structure>

- Use semantic path naming (plural nouns for collections)
- Use consistent HTTP status codes and response patterns
- Provide request/response examples for complex operations
- Use components/reuse for common schemas
- Apply proper security schemes (JWT Bearer authentication)
- Use descriptive operationId values for client generation

<validation>

- Define clear validation rules and constraints
- Use appropriate data types (string, integer, uuid, etc.)
- Provide meaningful error responses with proper status codes
- Include pagination for list endpoints
- Use extendible enum values for constrained fields
- Apply minLength/maxLength constraints appropriately
  </validation>

<generation>

- Ensure generated TypeScript code compiles without errors
- Verify all models are properly exported in index files
- Test generated clients against the actual API
- Maintain backward compatibility when updating specifications
  </generation>

</style_guide>

<workflow name="development">
<steps>
1. **Specification Updates:**
   - Modify `openapi.yaml` with API changes
   - Run `yarn lint:api` to validate OpenAPI specification
   - Run `yarn generate:api` to update TypeScript client

2. **Quality Assurance:**

   - Test generated client against backend API
   - Verify TypeScript compilation of generated code
   - Check documentation generation with `yarn generate:docs`

3. **Integration Testing:**
   - Link package locally for development with consuming projects
   - Test client integration in real scenarios
   - Validate error handling and type safety
     </steps>

<validation>
After each step, execute `yarn lint:api` to ensure OpenAPI specification quality and prevent regressions before proceeding.
</validation>

<hint>
If you need to understand which modifications have been done to files, you can use the git --no-pager diff command.
</hint>

<constraints>
- Never perform a 'git commit', 'git stash' or 'git push'. You are not allowed to perform these actions. You can only act in read only mode on git.
- Never perform a 'yarn publish'.
- Do not use 'npx', use 'yarn' instead.
- Always validate OpenAPI changes before generating clients
- Maintain backward compatibility for breaking changes
</constraints>
</workflow>

<validation>
Always run `yarn lint:api` after modifying `openapi.yaml` to ensure specification quality.
</validation>

<available_scripts>

<table>
| Script Name | How to Trigger | Description | Expected Output / Behavior | Blocking? |
| --- | --- | --- | --- | --- |
| `generate:api` | `yarn generate:api` | Generates TypeScript API client from OpenAPI specification. Creates models, services, and index files. | Generated TypeScript files in `generated/openapi/model/`. Output logs from OpenAPI Generator CLI. | No |
| `lint:api` | `yarn lint:api` | Lints `openapi.yaml` file using Spectral with custom ruleset. Validates OpenAPI 3.0 compliance and best practices. | Spectral linting output showing any rule violations or success message. | No |
| `build` | `yarn build` | Compiles TypeScript source files to JavaScript using tsconfig.build.json. Creates distribution files in `dist/` directory. | TypeScript compilation output. Built JavaScript and type declaration files. | No |
| `generate:docs` | `yarn generate:docs` | Generates HTML API documentation from OpenAPI specification using ReDoc. Creates interactive documentation in `dist/index.html`. | ReDoc build output with generated documentation file. | No |
| `generate:index` | `yarn generate:index` | Generates index.ts export file for all TypeScript models in `generated/openapi/model/`. Enables clean imports for client users. | Creates/updates `generated/openapi/model/index.ts` with export statements. | No |
| `prepublishOnly` | `yarn prepublishOnly` | Pre-publish hook that automatically runs `generate:api` to ensure generated code is current before publishing. | Same output as `generate:api` command. | No |
</table>

<directory_structure>

**Root Level:**

- `openapi.yaml` - Main OpenAPI 3.0 specification
- `package.json` - Package configuration and dependencies
- `README.md` - Project documentation and usage instructions
- `AGENTS.md` - Development guidelines and workflows

**Generated Output:**

- `generated/openapi/model/` - Auto-generated TypeScript models and client code
- `generated/openapi/model/index.ts` - Auto-generated export index file
- `dist/` - Compiled JavaScript output for npm distribution

**Build Artifacts:**

- `.gitignore` - Excludes generated and build artifacts
- `.openapi-generator-ignore` - OpenAPI Generator exclusion rules
  </directory_structure>

<local_development>

For local development with the Approvio bakcned (if available) and testing with the generated API client:

2. **Linking in Consuming Project:**

   ```bash
   cd <PATH OF CONSUMING PROJECT> (e.g. '/workspace/approvio')
   yarn link <PATH TO APPROVIO API ROOT DIRECTORY>
   ```

3. **Development Workflow:**

   - Make changes to `openapi.yaml`
   - Run `yarn generate:api` to update client
   - Test changes in consuming project
   - Iterate until API changes are complete

4. **Unlinking and publishing:**
   - After the test are done, a human (with the necessary credentials) will publish the API for you and update the package.json of the consumers.
     </local_development>
